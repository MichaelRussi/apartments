####################################### Linear Regression #######################################

#The following script is just a starting point for a machine learning project to predict the price
#of apartments.A refinement of the present model and others algorithms  will be available soon.  

#load libraries
library(tidyverse)


#load the data
df <- read.csv('apartments.csv') 

#Select 16 out of 27 neighborhoods that concentrate at least 1% of apartments.

#create selected variable 
selected <- c('Praia Brava','Fazenda', 'Centro','Sao Joao', 'Vila Operaria',
              'Sao Judas','Santa Clara','Ressacada','Dom Bosco','São Vicente',
              'Cordeiros','Espinheiros','Cabeçudas','Itaipava','Carvalho',
              'Fazendinha','Murta')

#create a new column containing the selected neighborhoods.The remaining 5% will be 
#renamed to others
df$neighborhood_selected <- (if_else(df$neighborhood %in% selected, df$neighborhood, 'others'))


#exclude variables and and filter out 'others'
df <- df %>%
  select(-X, -address,-neighborhood) %>%
  filter(neighborhood_selected != 'others')

#take a look at the price
summary(df$price) 

#separate between train and test data
filter <- sample(1:nrow(df), nrow(df) * 0.7) 

train <- df[filter,]
test <- df[-filter,]

#create model 
model <- lm(price ~ ., train) 

#predict prices in the test data
pred <- predict(model, test) 

#calculate r2
sqt <- sum((mean(test$price) - test$price)**2) 
sqres <- sum((pred - test$price)**2)
R2 <- (sqt -sqres) /sqt
R2

summary(model)

#compare actual and predicted price
test[3,] 
pred[3] 
